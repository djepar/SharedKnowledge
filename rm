<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajouter un livre - Français Secondaire 2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dist/main.css') }}">
</head>
<body>
    <!-- Navigation -->
    <div class="nav-bar">
        <div class="nav-links">
            <a href="{{ url_for('index') }}">🏠 Accueil</a>
            <a href="{{ url_for('dashboard') }}">📊 Tableau de bord</a>
            <a href="{{ url_for('calendar') }}">📅 Calendrier</a>
            <a href="{{ url_for('reading_log') }}">📚 Carnet de lecture</a>
        </div>
        <div>
            <span style="margin-right: 15px; font-weight: 500;">👋 {{ session.user }}</span>
            <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">Déconnexion</a>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}" style="max-width: 600px; margin: 0 auto var(--space-lg) auto;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Container principal -->
    <div class="add-book-container">
        <!-- Bouton retour -->
        <a href="{{ url_for('reading_log') }}" class="back-btn">← Retour au carnet</a>
        
        <!-- En-tête -->
        <div class="add-book-header">
            <h1>📖 Ajouter un livre</h1>
            <p>Enrichissez votre carnet de lecture personnel</p>
        </div>
        
        <!-- Formulaire d'ajout -->
        <form method="POST">
            <!-- Informations principales -->
            <div class="form-group">
                <label for="title">Titre du livre *</label>
                <input type="text" id="title" name="title" required 
                       placeholder="Ex: Le Petit Prince, Les Misérables...">
            </div>
            
            <div class="form-group">
                <label for="author">Auteur</label>
                <input type="text" id="author" name="author" 
                       placeholder="Ex: Antoine de Saint-Exupéry, Victor Hugo...">
            </div>
            
            <!-- Progression de lecture -->
            <div class="form-row">
                <div class="form-group">
                    <label for="pages_read">Pages lues</label>
                    <input type="number" id="pages_read" name="pages_read" min="0" 
                           placeholder="0">
                </div>
                
                <div class="form-group">
                    <label for="total_pages">Total de pages</label>
                    <input type="number" id="total_pages" name="total_pages" min="1" 
                           placeholder="Ex: 250">
                </div>
            </div>
            
            <!-- Date et évaluation -->
            <div class="form-row">
                <div class="form-group">
                    <label for="reading_date">Date de lecture *</label>
                    <input type="date" id="reading_date" name="reading_date" required>
                </div>
                
                <div class="form-group">
                    <label for="rating">Votre évaluation</label>
                    <select id="rating" name="rating">
                        <option value="">Choisir une note...</option>
                        <option value="1">⭐ 1 étoile - Décevant</option>
                        <option value="2">⭐⭐ 2 étoiles - Moyen</option>
                        <option value="3">⭐⭐⭐ 3 étoiles - Bien</option>
                        <option value="4">⭐⭐⭐⭐ 4 étoiles - Très bien</option>
                        <option value="5">⭐⭐⭐⭐⭐ 5 étoiles - Excellent</option>
                    </select>
                </div>
            </div>
            
            <!-- Notes personnelles -->
            <div class="form-group">
                <label for="notes">Notes personnelles</label>
                <textarea id="notes" name="notes" 
                          placeholder="Vos impressions, résumé, citations importantes, analyse personnelle...
                          
Exemples:
• Ce que j'ai aimé/pas aimé
• Personnages marquants
• Thèmes abordés
• Citations mémorables
• Liens avec d'autres œuvres"></textarea>
            </div>
            
            <!-- Bouton de soumission -->
            <button type="submit" class="submit-btn">
                📚 Ajouter au carnet de lecture
            </button>
        </form>
        
        <!-- Conseils -->
        <div style="background: var(--gray-100); padding: var(--space-lg); border-radius: var(--radius-md); margin-top: var(--space-xl);">
            <h3 style="color: var(--primary-color); margin-bottom: var(--space-sm);">💡 Conseils pour enrichir votre carnet</h3>
            <ul style="color: var(--gray-600); line-height: 1.6;">
                <li><strong>Soyez authentique</strong> : Notez vos vraies impressions, même si elles sont mitigées</li>
                <li><strong>Citez des passages</strong> : Gardez trace des phrases qui vous marquent</li>
                <li><strong>Faites des liens</strong> : Comparez avec d'autres livres ou films</li>
                <li><strong>Analysez les thèmes</strong> : Quels sujets importants sont abordés ?</li>
                <li><strong>Mettez à jour</strong> : Vous pouvez revenir modifier vos notes plus tard</li>
            </ul>
        </div>
    </div>

    <!-- JavaScript pour améliorer l'expérience utilisateur -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-calculer le pourcentage de lecture
            const pagesRead = document.getElementById('pages_read');
            const totalPages = document.getElementById('total_pages');
            
            function updateProgress() {
                const read = parseInt(pagesRead.value) || 0;
                const total = parseInt(totalPages.value) || 0;
                
                if (total > 0) {
                    const percentage = Math.round((read / total) * 100);
                    const progressInfo = document.getElementById('progress-info');
                    
                    if (!progressInfo) {
                        const info = document.createElement('div');
                        info.id = 'progress-info';
                        info.style.cssText = 'font-size: var(--font-size-sm); color: var(--primary-color); margin-top: 5px; font-weight: 500;';
                        totalPages.parentNode.appendChild(info);
                    }
                    
                    document.getElementById('progress-info').textContent = 
                        `Progression: ${percentage}% (${read}/${total} pages)`;
                }
            }
            
            pagesRead.addEventListener('input', updateProgress);
            totalPages.addEventListener('input', updateProgress);
            
            // Validation en temps réel
            const form = document.querySelector('form');
            form.addEventListener('submit', function(e) {
                const title = document.getElementById('title').value.trim();
                const date = document.getElementById('reading_date').value;
                
                if (!title) {
                    alert('⚠️ Le titre du livre est obligatoire');
                    e.preventDefault();
                    return;
                }
                
                if (!date) {
                    alert('⚠️ La date de lecture est obligatoire');
                    e.preventDefault();
                    return;
                }
                
                // Vérification que les pages lues ne dépassent pas le total
                const read = parseInt(pagesRead.value) || 0;
                const total = parseInt(totalPages.value) || 0;
                
                if (total > 0 && read > total) {
                    alert('⚠️ Le nombre de pages lues ne peut pas dépasser le total');
                    e.preventDefault();
                    return;
                }
            });
            
            // Définir la date d'aujourd'hui par défaut
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reading_date').value = today;
            
            // Animation d'entrée
            const container = document.querySelector('.add-book-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                container.style.transition = 'all 0.5s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);
        });
    </script>
</body>
</html>
