<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnet de lecture - FranÃ§ais Secondaire 2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dist/main.css') }}">
</head>
<body>
    <!-- Navigation -->
    {% include 'components/navigation.html' %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}" style="max-width: 1200px; margin: 0 auto var(--space-lg) auto;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Container principal -->
    <div class="reading-container">
        <!-- En-tÃªte -->
        <div class="reading-header">
            <h1>ðŸ“š Mon carnet de lecture</h1>
            <p>Suivez vos lectures et crÃ©ez votre portfolio personnel</p>
        </div>
        
        <!-- Bouton d'ajout -->
        <div style="text-align: center; margin-bottom: var(--space-xl);">
            <a href="{{ url_for('add_book') }}" class="add-book-btn">
                âž• Ajouter un livre
            </a>
        </div>
        
        <!-- Statistiques rapides -->
        {% if books %}
        <div class="stats-grid" style="margin-bottom: var(--space-xl);">
            <div class="stat-card">
                <div class="stat-value">{{ books|length }}</div>
                <div class="stat-label">Livres lus</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">
                    {% set total_pages = books|selectattr(4)|map(attribute=4)|sum %}
                    {{ total_pages or 0 }}
                </div>
                <div class="stat-label">Pages lues</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-value">
                    {% set rated_books = books|selectattr(8)|list %}
                    {% if rated_books %}
                        {{ "%.1f"|format(rated_books|map(attribute=8)|sum / rated_books|length) }}
                    {% else %}
                        --
                    {% endif %}
                </div>
                <div class="stat-label">Note moyenne</div>
            </div>
        </div>
        {% endif %}
        
        <!-- Grille des livres -->
        {% if books %}
            <div class="books-grid">
                {% for book in books %}
                <div class="book-card">
                    <div class="book-title">{{ book[2] }}</div>
                    <div class="book-author">par {{ book[3] or 'Auteur inconnu' }}</div>
                    
                    <!-- Barre de progression -->
                    {% if book[5] and book[5] > 0 %}
                    <div class="book-progress">
                        <div class="book-progress-bar" 
                             style="width: {{ (book[4] / book[5] * 100) if book[4] else 0 }}%">
                        </div>
                    </div>
                    <div style="font-size: var(--font-size-sm); color: var(--gray-500); text-align: center; margin-top: 5px;">
                        {{ book[4] or 0 }}/{{ book[5] }} pages
                        ({{ "%.0f"|format((book[4] / book[5] * 100) if book[4] and book[5] > 0 else 0) }}%)
                    </div>
                    {% elif book[4] %}
                    <div style="font-size: var(--font-size-sm); color: var(--gray-500); text-align: center; margin: var(--space-sm) 0;">
                        {{ book[4] }} pages lues
                    </div>
                    {% endif %}
                    
                    <!-- Notes personnelles (extrait) -->
                    {% if book[7] %}
                    <div style="margin: var(--space-md) 0; font-style: italic; color: var(--gray-600); font-size: var(--font-size-sm); line-height: 1.4;">
                        "{{ book[7][:100] }}{% if book[7]|length > 100 %}...{% endif %}"
                    </div>
                    {% endif %}
                    
                    <!-- MÃ©tadonnÃ©es du livre -->
                    <div class="book-meta">
                        <span style="font-size: var(--font-size-sm);">
                            {% if book[6] %}
                                Lu le {{ book[6] }}
                            {% endif %}
                        </span>
                        <span class="rating">
                            {% if book[8] %}
                                {% for i in range(book[8]) %}â˜…{% endfor %}
                                {% for i in range(5 - book[8]) %}â˜†{% endfor %}
                            {% else %}
                                <span style="color: var(--gray-400);">Pas de note</span>
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Ã‰tat vide -->
            <div class="no-books">
                <div style="font-size: 4em; margin-bottom: var(--space-lg);">ðŸ“š</div>
                <h3 style="color: var(--gray-600); margin-bottom: var(--space-md);">
                    Aucun livre dans votre carnet
                </h3>
                <p style="margin-bottom: var(--space-xl);">
                    Commencez par ajouter votre premiÃ¨re lecture pour crÃ©er votre portfolio personnel !
                </p>
                <a href="{{ url_for('add_book') }}" class="btn btn-primary btn-lg">
                    ðŸ“– Ajouter mon premier livre
                </a>
            </div>
        {% endif %}
    </div>

    <!-- JavaScript pour les animations -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animation d'entrÃ©e pour les cartes de livres
            const bookCards = document.querySelectorAll('.book-card');
            bookCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.4s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });

            // Animation pour les statistiques
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.3s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }, index * 150);
            });
        });
    </script>
</body>
</html>
