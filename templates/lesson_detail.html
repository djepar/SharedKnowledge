<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√©ance {{ lesson[1] }} - Fran√ßais Secondaire 2</title>
    
    <!-- Built CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dist/main.css') }}">
</head>
<body>
    <!-- Navigation -->
    {% include 'components/navigation.html' %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}" style="max-width: 1000px; margin: 0 auto var(--space-lg) auto;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Container principal -->
    <div class="lesson-detail-container">
        <!-- En-t√™te de la le√ßon -->
        <div class="lesson-detail-header">
            <div class="lesson-number-badge">S√©ance {{ lesson[1] }}</div>
            <div class="lesson-detail-title">{{ lesson[5] }}</div>
            <div class="lesson-meta">
                {{ lesson[2].title() }} ‚Ä¢ Semaine {{ lesson[3] }} ‚Ä¢ Jour {{ lesson[4] }} ‚Ä¢ {{ lesson[7] }} minutes
            </div>
        </div>
        
        <!-- Contenu de la le√ßon -->
        <div class="lesson-detail-content">
            <!-- Bouton retour -->
            <a href="{{ url_for('calendar') }}" class="btn btn-secondary">‚Üê Retour au calendrier</a>
            
            <!-- Grille d'informations -->
            <div class="info-grid">
                <div class="info-card">
                    <h3>üéØ Comp√©tences vis√©es</h3>
                    <p>{{ lesson[8] or 'Comp√©tences selon le programme PFEQ' }}</p>
                </div>
                
                <div class="info-card">
                    <h3>üìã Mat√©riel n√©cessaire</h3>
                    <p>{{ lesson[9] or 'Mat√©riel standard de classe' }}</p>
                </div>
                
                <div class="info-card">
                    <h3>üéØ Objectifs p√©dagogiques</h3>
                    <p>{{ lesson[10] or 'Voir le contenu d√©taill√© ci-dessous' }}</p>
                </div>
                
                <div class="info-card">
                    <h3>‚è±Ô∏è Dur√©e de la s√©ance</h3>
                    <p>{{ lesson[7] }} minutes ({{ "%.1f"|format(lesson[7]/60) }} heures)</p>
                </div>
            </div>
            
            <!-- Tags des comp√©tences -->
            {% if lesson[11] %}
            <div class="tags-section">
                <h3 style="color: var(--primary-color); margin-bottom: var(--space-sm);">üè∑Ô∏è Tags :</h3>
                {% for tag in lesson[11].split(',') %}
                    <span class="tag tag-{{ tag.strip() }}">{{ tag.strip().title() }}</span>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Contenu d√©taill√© -->
            <div class="lesson-content-section">
                <h3>üìù D√©roulement d√©taill√© de la s√©ance</h3>
                <div style="background: var(--white); padding: var(--space-lg); border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
                    <pre style="white-space: pre-wrap; font-family: inherit; line-height: 1.6; margin: 0;">{{ lesson[6] }}</pre>
                </div>
            </div>
            
            <!-- Section progression -->
            <div class="progress-section">
                <div class="progress-section-title">üìä Votre progression pour cette s√©ance</div>
                
                {% if progress and progress[3] %}
                    <!-- S√©ance termin√©e -->
                    <div class="completed-status">
                        <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
                            <span style="font-size: 1.5em;">‚úÖ</span>
                            <strong>S√©ance termin√©e !</strong>
                        </div>
                        <p>Compl√©t√©e le {{ progress[5] or 'Date non disponible' }}</p>
                        {% if progress[4] %}
                            <div style="margin-top: var(--space-sm); padding-top: var(--space-sm); border-top: 1px solid #c3e6cb;">
                                <strong>Vos notes :</strong><br>
                                {{ progress[4] }}
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    <!-- S√©ance √† compl√©ter -->
                    <div style="margin-bottom: var(--space-lg);">
                        <p style="color: #1565c0; margin-bottom: var(--space-md);">
                            Marquez cette s√©ance comme termin√©e une fois que vous avez compl√©t√© toutes les activit√©s propos√©es.
                        </p>
                        <div style="background: rgba(21, 101, 192, 0.1); padding: var(--space-md); border-radius: var(--radius-sm); font-size: var(--font-size-sm);">
                            <strong>ÔøΩÔøΩ Conseil :</strong> Prenez le temps de bien suivre chaque √©tape du d√©roulement pour maximiser votre apprentissage.
                        </div>
                    </div>
                    
                    <form method="POST" action="{{ url_for('mark_complete', lesson_id=lesson[0]) }}" style="display: inline;">
                        <button type="submit" class="btn btn-success btn-lg">
                            ‚úÖ Marquer cette s√©ance comme termin√©e
                        </button>
                    </form>
                {% endif %}
            </div>
            
            <!-- Liens vers les nouvelles sections -->
            <div class="related-sections">
                <h3 style="color: var(--primary-color); margin-bottom: var(--space-md); text-align: center;">üîó Sections li√©es</h3>
                <div class="related-links-grid">
                    <a href="{{ url_for('theory') }}" class="related-link">
                        <div class="related-icon">üìä</div>
                        <div class="related-title">Ressources th√©oriques</div>
                        <div class="related-description">Acc√©dez aux contenus PowerPoint et th√©oriques</div>
                    </a>
                    
                    <a href="{{ url_for('exercises') }}" class="related-link">
                        <div class="related-icon">‚úèÔ∏è</div>
                        <div class="related-title">Exercices</div>
                        <div class="related-description">Pratiquez avec des exercices cibl√©s</div>
                    </a>
                    
                    <a href="{{ url_for('portfolio') }}" class="related-link">
                        <div class="related-icon">üìÅ</div>
                        <div class="related-title">Portfolio & Travaux</div>
                        <div class="related-description">G√©rez vos travaux et examens</div>
                    </a>
                </div>
            </div>
            
            <!-- Navigation entre les s√©ances -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--space-xl); padding-top: var(--space-lg); border-top: 2px solid var(--gray-200);">
                <div>
                    {% if lesson[1] > 1 %}
                    <a href="#" class="btn btn-outline-secondary" onclick="alert('Navigation entre s√©ances √† venir!')">
                        ‚Üê S√©ance pr√©c√©dente
                    </a>
                    {% endif %}
                </div>
                
                <div style="text-align: center;">
                    <span style="color: var(--gray-500); font-size: var(--font-size-sm);">
                        S√©ance {{ lesson[1] }} sur 160
                    </span>
                </div>
                
                <div>
                    {% if lesson[1] < 160 %}
                    <a href="#" class="btn btn-outline-secondary" onclick="alert('Navigation entre s√©ances √† venir!')">
                        S√©ance suivante ‚Üí
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript pour les animations et interactions -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Animation d'entr√©e
            const container = document.querySelector('.lesson-detail-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                container.style.transition = 'all 0.5s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);

            // Animation des cartes d'information
            const infoCards = document.querySelectorAll('.info-card');
            infoCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(10px)';
                
                setTimeout(() => {
                    card.style.transition = 'all 0.3s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 200 + (index * 100));
            });

            // Confirmation avant marquage comme termin√©
            const completeForm = document.querySelector('form[action*="mark_complete"]');
            if (completeForm) {
                completeForm.addEventListener('submit', function(e) {
                    const confirmed = confirm(
                        '‚úÖ Confirmer que vous avez termin√© cette s√©ance ?\n\n' +
                        'Cette action marquera la s√©ance comme compl√©t√©e dans votre progression.'
                    );
                    
                    if (!confirmed) {
                        e.preventDefault();
                    }
                });
            }

            // Mise en √©vidence du contenu lors du scroll
            const contentSection = document.querySelector('.lesson-content-section');
            if (contentSection) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.style.transform = 'scale(1.02)';
                            entry.target.style.transition = 'transform 0.3s ease';
                            
                            setTimeout(() => {
                                entry.target.style.transform = 'scale(1)';
                            }, 300);
                        }
                    });
                }, { threshold: 0.5 });
                
                observer.observe(contentSection);
            }
        });
    </script>
</body>
</html>
