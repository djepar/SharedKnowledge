<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier la s√©ance {{ lesson[1] }} - Fran√ßais Secondaire 2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dist/main.css') }}">
</head>
<body>
    <!-- Navigation -->
    {% include 'components/navigation.html' %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}" style="max-width: 800px; margin: 0 auto var(--space-lg) auto;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Container principal -->
    <div class="edit-lesson-container">
        <!-- Bouton retour -->
        <a href="{{ url_for('lesson_detail', lesson_id=lesson[0]) }}" class="back-btn">‚Üê Retour √† la s√©ance</a>
        
        <!-- En-t√™te -->
        <div class="edit-lesson-header">
            <div class="lesson-number-badge">S√©ance {{ lesson[1] }}</div>
            <h1>‚úèÔ∏è Modifier la le√ßon</h1>
            <p>Modification du programme PFEQ fran√ßais secondaire 2</p>
        </div>
        
        <!-- Formulaire de modification -->
        <form method="POST" class="lesson-form">
            <!-- Informations g√©n√©rales -->
            <div class="form-section">
                <h2>üìã Informations g√©n√©rales</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="subject">Discipline *</label>
                        <select id="subject" name="subject" required>
                            <option value="">Choisir la discipline...</option>
                            {% for subject in available_subjects %}
                            <option value="{{ subject }}" {{ 'selected' if lesson[14] == subject else '' }}>
                                {{ subject.replace('_', ' ').title() }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">Titre de la le√ßon *</label>
                        <input type="text" id="title" name="title" required 
                               value="{{ lesson[5] }}"
                               placeholder="Ex: L'analyse litt√©raire - Les proc√©d√©s stylistiques">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="month">Mois *</label>
                        <select id="month" name="month" required>
                            <option value="">Choisir le mois...</option>
                            {% for month in ['septembre', 'octobre', 'novembre', 'd√©cembre', 'janvier', 'f√©vrier', 'mars', 'avril', 'mai', 'juin'] %}
                            <option value="{{ month }}" {{ 'selected' if lesson[2] == month else '' }}>
                                {{ month.title() }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="week">Semaine du mois *</label>
                        <select id="week" name="week" required>
                            <option value="">Choisir la semaine...</option>
                            {% for week_num in range(1, 5) %}
                            <option value="{{ week_num }}" {{ 'selected' if lesson[3] == week_num else '' }}>
                                Semaine {{ week_num }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="day">Jour de la semaine *</label>
                        <select id="day" name="day" required>
                            <option value="">Choisir le jour...</option>
                            {% for day_num in range(1, 6) %}
                            <option value="{{ day_num }}" {{ 'selected' if lesson[4] == day_num else '' }}>
                                Jour {{ day_num }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="duration">Dur√©e (minutes) *</label>
                        <input type="number" id="duration" name="duration" min="15" max="180" required 
                               value="{{ lesson[7] }}"
                               placeholder="75">
                        <small>Dur√©e habituelle : 75 minutes</small>
                    </div>
                    
                </div>
            </div>

            <!-- Contenu p√©dagogique -->
            <div class="form-section">
                <h2>üéØ Contenu p√©dagogique</h2>
                
                <div class="form-group">
                    <label for="objectives">Objectifs d'apprentissage *</label>
                    <textarea id="objectives" name="objectives" required 
                              placeholder="D√©crivez les objectifs sp√©cifiques de cette le√ßon...">{{ lesson[10] or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="content">D√©roulement de la le√ßon *</label>
                    <textarea id="content" name="content" class="content-textarea" required 
                              placeholder="D√©crivez le d√©roulement d√©taill√© de la s√©ance...">{{ lesson[6] }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="materials">Mat√©riel et ressources</label>
                    <textarea id="materials" name="materials" 
                              placeholder="Listez le mat√©riel n√©cessaire pour cette le√ßon...">{{ lesson[9] or '' }}</textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="evaluation">√âvaluation</label>
                        <select id="evaluation" name="evaluation">
                            <option value="">Type d'√©valuation...</option>
                            {% for eval_type in ['formative', 'sommative', 'auto√©valuation', 'co√©valuation', 'observation'] %}
                            <option value="{{ eval_type }}" {{ 'selected' if lesson[12] == eval_type else '' }}>
                                {{ eval_type.replace('√©', '√â').title().replace('√â', '√©') }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="homework">Travaux √† la maison</label>
                        <input type="text" id="homework" name="homework" 
                               value="{{ lesson[13] or '' }}"
                               placeholder="Ex: Lire le chapitre 3, exercices 1-5">
                    </div>
                </div>
            </div>

            <!-- Diff√©renciation p√©dagogique -->
            <div class="form-section">
                <h2>üîÑ Diff√©renciation p√©dagogique</h2>
                
                <div class="form-group">
                    <label for="adaptations">Adaptations et soutien</label>
                    <textarea id="adaptations" name="adaptations" 
                              placeholder="D√©crivez les adaptations pour diff√©rents profils d'√©l√®ves...">{{ lesson[15] or '' }}</textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes p√©dagogiques</label>
                    <textarea id="notes" name="notes" 
                              placeholder="Ajoutez vos notes, r√©flexions et am√©liorations √† apporter...">{{ lesson[16] or '' }}</textarea>
                </div>
            </div>
            
            <!-- Boutons d'action -->
            <div class="form-actions">
                <button type="submit" name="action" value="save" class="btn btn-success btn-lg">
                    üíæ Enregistrer les modifications
                </button>
                <a href="{{ url_for('lesson_detail', lesson_id=lesson[0]) }}" class="btn btn-secondary btn-lg">
                    ‚ùå Annuler
                </a>
            </div>
        </form>
        
        <!-- Zone de danger -->
        <div class="danger-zone">
            <h3>‚ö†Ô∏è Zone de danger</h3>
            <p>Cette action est irr√©versible et supprimera d√©finitivement la le√ßon.</p>
            <form method="POST" action="{{ url_for('delete_lesson', lesson_id=lesson[0]) }}" 
                  onsubmit="return confirm('‚ö†Ô∏è √ätes-vous absolument certain de vouloir supprimer cette le√ßon ?\n\nCette action est irr√©versible et supprimera :\n‚Ä¢ Tout le contenu de la le√ßon\n‚Ä¢ Votre progression associ√©e\n‚Ä¢ Les √©valuations li√©es\n\nTapez \'SUPPRIMER\' dans la bo√Æte de dialogue suivante pour confirmer.');">
                <button type="submit" class="btn btn-danger">
                    üóëÔ∏è Supprimer cette le√ßon
                </button>
            </form>
        </div>
    </div>

    <!-- JavaScript pour am√©liorer l'exp√©rience utilisateur -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-sauvegarde en brouillon (localStorage)
            const form = document.querySelector('.lesson-form');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            // Sauvegarder automatiquement les modifications
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    localStorage.setItem(`lesson_edit_draft_${this.name}_{{ lesson[0] }}`, this.value);
                });
            });
            
            // Nettoyer le brouillon lors de la soumission
            form.addEventListener('submit', function() {
                formModified = false; // Reset flag to prevent beforeunload warning
                inputs.forEach(input => {
                    localStorage.removeItem(`lesson_edit_draft_${input.name}_{{ lesson[0] }}`);
                });
            });
            
            // Validation avant soumission
            form.addEventListener('submit', function(e) {
                const title = document.getElementById('title').value.trim();
                const content = document.getElementById('content').value.trim();
                const objectives = document.getElementById('objectives').value.trim();
                
                if (!title) {
                    alert('‚ö†Ô∏è Le titre de la le√ßon est obligatoire');
                    e.preventDefault();
                    return;
                }
                
                if (!objectives) {
                    alert('‚ö†Ô∏è Les objectifs d\'apprentissage sont obligatoires');
                    e.preventDefault();
                    return;
                }
                
                if (!content) {
                    alert('‚ö†Ô∏è Le d√©roulement de la le√ßon est obligatoire');
                    e.preventDefault();
                    return;
                }
            });
            
            // Compteur de caract√®res pour les zones de texte importantes
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                const counter = document.createElement('div');
                counter.className = 'char-counter';
                textarea.parentNode.appendChild(counter);
                
                function updateCounter() {
                    const length = textarea.value.length;
                    counter.textContent = `${length} caract√®res`;
                }
                
                textarea.addEventListener('input', updateCounter);
                updateCounter();
            });

            // Animation d'entr√©e
            const container = document.querySelector('.edit-lesson-container');
            container.style.opacity = '0';
            container.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                container.style.transition = 'all 0.5s ease';
                container.style.opacity = '1';
                container.style.transform = 'translateY(0)';
            }, 100);

            // Confirmation des modifications non sauvegard√©es
            let formModified = false;
            inputs.forEach(input => {
                const originalValue = input.value;
                input.addEventListener('input', function() {
                    if (this.value !== originalValue) {
                        formModified = true;
                    }
                });
            });

            window.addEventListener('beforeunload', function(e) {
                if (formModified) {
                    e.preventDefault();
                    e.returnValue = 'Vous avez des modifications non sauvegard√©es. Voulez-vous vraiment quitter cette page ?';
                }
            });
        });
    </script>
</body>
</html>