{% extends "base.html" %}

{% block title %}Importer le programme de math√©matiques - Classroom App{% endblock %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/math-schedule.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/components/forms.css') }}">
{% endblock %}

{% block content %}
<div class="math-overview-container math-fade-in">
    <!-- Math Import Header -->
    <div class="math-header">
        <h1>üî¢ Importer le programme de math√©matiques</h1>
        <p>Int√©grez le curriculum complet de math√©matiques PFEQ secondaire 2</p>
    </div>

    <!-- Import Options Grid -->
    <div class="math-stats-grid">
        <div class="math-stat-card import-option" data-type="complete">
            <div class="math-stat-header">
                <div class="math-stat-icon">üìö</div>
            </div>
            <div class="math-stat-label">Programme complet</div>
            <div class="math-stat-description">
                Importez l'int√©gralit√© du programme de math√©matiques PFEQ avec 160 s√©ances structur√©es sur 20 cycles d'apprentissage.
            </div>
            <div class="math-competency-count" style="margin-top: var(--space-md);">
                160 s√©ances ‚Ä¢ 5 unit√©s ‚Ä¢ 20 cycles
            </div>
        </div>

        <div class="math-stat-card import-option" data-type="sample">
            <div class="math-stat-header">
                <div class="math-stat-icon">üéØ</div>
            </div>
            <div class="math-stat-label">√âchantillon d√©monstratif</div>
            <div class="math-stat-description">
                Importez un √©chantillon de 20 s√©ances pour d√©couvrir la structure et tester le syst√®me avant l'importation compl√®te.
            </div>
            <div class="math-competency-count" style="margin-top: var(--space-md);">
                20 s√©ances d'exemple
            </div>
        </div>

        <div class="math-stat-card import-option" data-type="custom">
            <div class="math-stat-header">
                <div class="math-stat-icon">‚öôÔ∏è</div>
            </div>
            <div class="math-stat-label">Import personnalis√©</div>
            <div class="math-stat-description">
                S√©lectionnez sp√©cifiquement les unit√©s et cycles √† importer selon vos besoins p√©dagogiques.
            </div>
            <div class="math-competency-count" style="margin-top: var(--space-md);">
                Import flexible
            </div>
        </div>
    </div>

    <!-- Math Units Preview -->
    <div style="margin-bottom: var(--space-2xl);">
        <h2 style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--primary-color); margin-bottom: var(--space-lg); text-align: center;">
            üìä Aper√ßu du programme PFEQ
        </h2>
        
        <div class="math-units-grid">
            <div class="math-unit-card">
                <div class="math-unit-header">
                    <div class="math-unit-number">Unit√© 1</div>
                    <div class="math-unit-title">Arithm√©tique et sens du nombre</div>
                    <div class="math-unit-icon">üî¢</div>
                </div>
                <div class="math-unit-content">
                    <div class="math-unit-description">
                        Fondements arithm√©tiques, nombres r√©els, proportionnalit√©
                    </div>
                    <div class="math-unit-info">
                        <span class="math-unit-cycles">Cycles 1-4</span>
                        <span class="math-unit-lessons">32 s√©ances</span>
                    </div>
                </div>
            </div>

            <div class="math-unit-card">
                <div class="math-unit-header">
                    <div class="math-unit-number">Unit√© 2</div>
                    <div class="math-unit-title">Introduction √† l'alg√®bre</div>
                    <div class="math-unit-icon">üìä</div>
                </div>
                <div class="math-unit-content">
                    <div class="math-unit-description">
                        Pens√©e alg√©brique, expressions, √©quations de base
                    </div>
                    <div class="math-unit-info">
                        <span class="math-unit-cycles">Cycles 5-8</span>
                        <span class="math-unit-lessons">32 s√©ances</span>
                    </div>
                </div>
            </div>

            <div class="math-unit-card">
                <div class="math-unit-header">
                    <div class="math-unit-number">Unit√© 3</div>
                    <div class="math-unit-title">G√©om√©trie et mesures</div>
                    <div class="math-unit-icon">üìê</div>
                </div>
                <div class="math-unit-content">
                    <div class="math-unit-description">
                        Figures planes, solides, constructions g√©om√©triques
                    </div>
                    <div class="math-unit-info">
                        <span class="math-unit-cycles">Cycles 9-13</span>
                        <span class="math-unit-lessons">40 s√©ances</span>
                    </div>
                </div>
            </div>

            <div class="math-unit-card">
                <div class="math-unit-header">
                    <div class="math-unit-number">Unit√© 4</div>
                    <div class="math-unit-title">Statistiques et probabilit√©s</div>
                    <div class="math-unit-icon">üìà</div>
                </div>
                <div class="math-unit-content">
                    <div class="math-unit-description">
                        Analyse de donn√©es, sondages, probabilit√©s de base
                    </div>
                    <div class="math-unit-info">
                        <span class="math-unit-cycles">Cycles 14-16</span>
                        <span class="math-unit-lessons">24 s√©ances</span>
                    </div>
                </div>
            </div>

            <div class="math-unit-card">
                <div class="math-unit-header">
                    <div class="math-unit-number">Unit√© 5</div>
                    <div class="math-unit-title">Int√©gration et projets</div>
                    <div class="math-unit-icon">üéØ</div>
                </div>
                <div class="math-unit-content">
                    <div class="math-unit-description">
                        R√©solution de probl√®mes complexes, projets int√©grateurs
                    </div>
                    <div class="math-unit-info">
                        <span class="math-unit-cycles">Cycles 17-20</span>
                        <span class="math-unit-lessons">32 s√©ances</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Warning and Actions -->
    <div style="background: var(--warning-50); border: 2px solid var(--warning-200); border-radius: var(--radius-lg); padding: var(--space-xl); margin-bottom: var(--space-xl);">
        <h3 style="color: var(--warning-800); margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-sm);">
            ‚ö†Ô∏è Important avant l'importation
        </h3>
        <ul style="color: var(--warning-700); margin: var(--space-sm) 0; padding-left: var(--space-lg);">
            <li>L'importation peut prendre quelques minutes selon la taille du programme</li>
            <li>Les s√©ances existantes en math√©matiques seront conserv√©es (pas de duplication)</li>
            <li>Vous pourrez modifier et personnaliser les s√©ances apr√®s l'importation</li>
            <li>Un backup automatique de votre base de donn√©es sera cr√©√©</li>
        </ul>
    </div>

    <!-- Action Buttons -->
    <div style="text-align: center; margin-top: var(--space-xl);">
        <div style="display: flex; gap: var(--space-md); justify-content: center; flex-wrap: wrap;">
            <button class="btn btn-primary btn-lg" id="import-btn" onclick="confirmImport()">
                üì• Importer le programme s√©lectionn√©
            </button>
            <a href="{{ url_for('math_schedule_overview') }}" class="btn btn-secondary btn-lg">
                ‚Üê Retour √† l'aper√ßu
            </a>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmation-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
    <div style="background: var(--white); border-radius: var(--radius-lg); padding: var(--space-2xl); max-width: 500px; margin: var(--space-md); text-align: center; box-shadow: var(--shadow-2xl);">
        <div style="font-size: 4rem; margin-bottom: var(--space-md);">üî¢</div>
        <h3 id="modal-title" style="margin-bottom: var(--space-md); color: var(--gray-900);">Confirmer l'importation</h3>
        <p id="modal-message" style="color: var(--gray-600); margin-bottom: var(--space-lg);">
            √ätes-vous s√ªr de vouloir importer le programme de math√©matiques complet ?
        </p>
        <div style="display: flex; gap: var(--space-md); justify-content: center;">
            <button class="btn btn-primary" onclick="executeImport()" id="confirm-import-btn">
                ‚úÖ Confirmer l'importation
            </button>
            <button class="btn btn-secondary" onclick="hideConfirmation()">
                ‚ùå Annuler
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let selectedImportType = 'complete';

document.addEventListener('DOMContentLoaded', function() {
    // Import option selection
    const importOptions = document.querySelectorAll('.import-option');
    
    importOptions.forEach(option => {
        option.addEventListener('click', function() {
            // Remove active state from all options
            importOptions.forEach(opt => opt.style.borderColor = 'var(--gray-200)');
            
            // Add active state to selected option
            this.style.borderColor = 'var(--primary-color)';
            
            // Update selected type
            selectedImportType = this.dataset.type;
            
            // Update button text
            updateImportButton();
        });
    });
    
    // Set default selection
    document.querySelector('[data-type="complete"]').style.borderColor = 'var(--primary-color)';
    updateImportButton();
    
    // Animation for cards
    const cards = document.querySelectorAll('.math-stat-card, .math-unit-card');
    cards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});

function updateImportButton() {
    const importBtn = document.getElementById('import-btn');
    
    switch(selectedImportType) {
        case 'complete':
            importBtn.innerHTML = 'üì• Importer le programme complet (160 s√©ances)';
            break;
        case 'sample':
            importBtn.innerHTML = 'üì• Importer l\'√©chantillon (20 s√©ances)';
            break;
        case 'custom':
            importBtn.innerHTML = 'üì• Configuration personnalis√©e';
            break;
    }
}

function confirmImport() {
    if (selectedImportType === 'custom') {
        alert('üöß L\'import personnalis√© sera disponible dans une prochaine version.\n\nEn attendant, vous pouvez importer le programme complet et d√©sactiver les unit√©s non d√©sir√©es depuis l\'aper√ßu du programme.');
        return;
    }
    
    const modal = document.getElementById('confirmation-modal');
    const title = document.getElementById('modal-title');
    const message = document.getElementById('modal-message');
    const confirmBtn = document.getElementById('confirm-import-btn');
    
    switch(selectedImportType) {
        case 'complete':
            title.textContent = 'Importer le programme complet';
            message.textContent = '√ätes-vous s√ªr de vouloir importer les 160 s√©ances du programme de math√©matiques PFEQ ? Cette op√©ration peut prendre quelques minutes.';
            confirmBtn.innerHTML = '‚úÖ Importer 160 s√©ances';
            break;
        case 'sample':
            title.textContent = 'Importer l\'√©chantillon d√©monstratif';
            message.textContent = 'Voulez-vous importer un √©chantillon de 20 s√©ances pour d√©couvrir le programme ? Vous pourrez importer le programme complet plus tard.';
            confirmBtn.innerHTML = '‚úÖ Importer 20 s√©ances';
            break;
    }
    
    modal.style.display = 'flex';
}

function hideConfirmation() {
    document.getElementById('confirmation-modal').style.display = 'none';
}

function executeImport() {
    const confirmBtn = document.getElementById('confirm-import-btn');
    
    // Show loading state
    confirmBtn.disabled = true;
    confirmBtn.innerHTML = '‚è≥ Importation en cours...';
    
    // Create form and submit
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ url_for("import_math_schedule") }}';
    
    const typeInput = document.createElement('input');
    typeInput.type = 'hidden';
    typeInput.name = 'import_type';
    typeInput.value = selectedImportType;
    form.appendChild(typeInput);
    
    document.body.appendChild(form);
    form.submit();
}

// Close modal when clicking outside
document.getElementById('confirmation-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        hideConfirmation();
    }
});
</script>
{% endblock %}