<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er une le√ßon - Fran√ßais Secondaire 2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dist/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/edit-lesson.css') }}">
</head>
<body>
    <!-- Navigation -->
    {% include 'components/navigation.html' %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}" style="max-width: 800px; margin: 0 auto var(--space-lg) auto;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Container principal -->
    <div class="create-lesson-container">
        <!-- Bouton retour -->
        <a href="{{ url_for('lessons_list') }}" class="back-btn">‚Üê Retour √† la liste des le√ßons</a>
        
        <!-- En-t√™te -->
        <div class="create-lesson-header">
            <h1>üìù Cr√©er une nouvelle le√ßon</h1>
            <p>Concevoir une s√©ance du programme PFEQ fran√ßais secondaire 2</p>
        </div>
        
        <!-- Formulaire de cr√©ation -->
        <form method="POST" class="lesson-form">
            <!-- Informations g√©n√©rales -->
            <div class="form-section">
                <h2>üìã Informations g√©n√©rales</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="subject">Discipline *</label>
                        <select id="subject" name="subject" required>
                            <option value="">Choisir la discipline...</option>
                            {% for subject in available_subjects %}
                            <option value="{{ subject }}">{{ subject.replace('_', ' ').title() }}</option>
                            {% endfor %}
                        </select>
                        <small>La s√©ance sera automatiquement num√©rot√©e pour cette discipline</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">Titre de la le√ßon *</label>
                        <input type="text" id="title" name="title" required 
                               placeholder="Ex: L'analyse litt√©raire - Les proc√©d√©s stylistiques">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="month">Mois *</label>
                        <select id="month" name="month" required>
                            <option value="">Choisir le mois...</option>
                            <option value="septembre">Septembre</option>
                            <option value="octobre">Octobre</option>
                            <option value="novembre">Novembre</option>
                            <option value="d√©cembre">D√©cembre</option>
                            <option value="janvier">Janvier</option>
                            <option value="f√©vrier">F√©vrier</option>
                            <option value="mars">Mars</option>
                            <option value="avril">Avril</option>
                            <option value="mai">Mai</option>
                            <option value="juin">Juin</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="week">Semaine du mois *</label>
                        <select id="week" name="week" required>
                            <option value="">Choisir la semaine...</option>
                            <option value="1">Semaine 1</option>
                            <option value="2">Semaine 2</option>
                            <option value="3">Semaine 3</option>
                            <option value="4">Semaine 4</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="day">Jour de la semaine *</label>
                        <select id="day" name="day" required>
                            <option value="">Choisir le jour...</option>
                            <option value="1">Jour 1</option>
                            <option value="2">Jour 2</option>
                            <option value="3">Jour 3</option>
                            <option value="4">Jour 4</option>
                            <option value="5">Jour 5</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="session_number">Num√©ro de s√©ance *</label>
                        <input type="number" id="session_number" name="session_number" min="1" required 
                               placeholder="1">
                        <small>Num√©ro de la s√©ance</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="duration">Dur√©e (minutes) *</label>
                        <input type="number" id="duration" name="duration" min="15" max="180" required 
                               placeholder="75" value="75">
                        <small>Dur√©e habituelle : 75 minutes</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="competence">Comp√©tence principale *</label>
                        <select id="competence" name="competence" required>
                            <option value="">Choisir la comp√©tence...</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Contenu p√©dagogique -->
            <div class="form-section">
                <h2>üéØ Contenu p√©dagogique</h2>
                
                <div class="form-group">
                    <label for="objectives">Objectifs d'apprentissage *</label>
                    <textarea id="objectives" name="objectives" required 
                              placeholder="D√©crivez les objectifs sp√©cifiques de cette le√ßon...

Exemples:
‚Ä¢ Identifier les proc√©d√©s stylistiques dans un texte litt√©raire
‚Ä¢ Analyser l'effet des figures de style sur le sens
‚Ä¢ R√©diger une analyse structur√©e de 200 mots"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="content">D√©roulement de la le√ßon *</label>
                    <textarea id="content" name="content" class="content-textarea" required 
                              placeholder="D√©crivez le d√©roulement d√©taill√© de la s√©ance...

Structure sugg√©r√©e:
1. AMORCE (10 min) - Activation des connaissances
2. EXPLORATION (25 min) - D√©couverte du concept
3. PRATIQUE GUID√âE (25 min) - Exercices avec accompagnement
4. PRATIQUE AUTONOME (10 min) - Application individuelle
5. OBJECTIVATION (5 min) - Retour sur les apprentissages

D√©taillez chaque √©tape avec:
‚Ä¢ Les activit√©s propos√©es
‚Ä¢ Le mat√©riel n√©cessaire
‚Ä¢ Les consignes pr√©cises
‚Ä¢ Les crit√®res d'√©valuation"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="materials">Mat√©riel et ressources</label>
                    <textarea id="materials" name="materials" 
                              placeholder="Listez le mat√©riel n√©cessaire pour cette le√ßon...

Exemples:
‚Ä¢ Manuel de fran√ßais (pages XX √† XX)
‚Ä¢ Extraits litt√©raires distribu√©s
‚Ä¢ Grille d'analyse
‚Ä¢ Tableau interactif
‚Ä¢ Vid√©o d'introduction (lien)
‚Ä¢ Cahier d'exercices"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="evaluation">√âvaluation</label>
                        <select id="evaluation" name="evaluation">
                            <option value="">Type d'√©valuation...</option>
                            <option value="formative">√âvaluation formative</option>
                            <option value="sommative">√âvaluation sommative</option>
                            <option value="auto√©valuation">Auto√©valuation</option>
                            <option value="co√©valuation">Co√©valuation</option>
                            <option value="observation">Observation</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="homework">Travaux √† la maison</label>
                        <input type="text" id="homework" name="homework" 
                               placeholder="Ex: Lire le chapitre 3, exercices 1-5">
                    </div>
                </div>
            </div>

            <!-- Diff√©renciation p√©dagogique -->
            <div class="form-section">
                <h2>üîÑ Diff√©renciation p√©dagogique</h2>
                
                <div class="form-group">
                    <label for="adaptations">Adaptations et soutien</label>
                    <textarea id="adaptations" name="adaptations" 
                              placeholder="D√©crivez les adaptations pour diff√©rents profils d'√©l√®ves...

Exemples:
‚Ä¢ Pour les √©l√®ves en difficult√© : support visuel suppl√©mentaire, temps prolong√©
‚Ä¢ Pour les √©l√®ves avanc√©s : exercices d'enrichissement, r√¥le de tuteur
‚Ä¢ Pour les √©l√®ves ayant des besoins particuliers : consignes simplifi√©es
‚Ä¢ Strat√©gies d'enseignement universal (SEU)"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes p√©dagogiques</label>
                    <textarea id="notes" name="notes" 
                              placeholder="Ajoutez vos notes, r√©flexions et am√©liorations √† apporter...

‚Ä¢ Points d'attention particuliers
‚Ä¢ Liens avec les le√ßons pr√©c√©dentes/suivantes
‚Ä¢ Suggestions d'activit√©s alternatives
‚Ä¢ Observations sur l'efficacit√© de la le√ßon
‚Ä¢ Modifications √† pr√©voir pour l'ann√©e suivante"></textarea>
                </div>
            </div>
            
            <!-- Boutons d'action -->
            <div class="form-actions">
                <button type="submit" name="action" value="save" class="btn btn-success btn-lg">
                    üíæ Enregistrer la le√ßon
                </button>
                <button type="submit" name="action" value="save_and_continue" class="btn btn-primary btn-lg">
                    ‚û°Ô∏è Enregistrer et cr√©er la suivante
                </button>
                <a href="{{ url_for('lessons_list') }}" class="btn btn-secondary btn-lg">
                    ‚ùå Annuler
                </a>
            </div>
        </form>
        
        <!-- Conseils p√©dagogiques -->
        <div class="tips-section">
            <h3>üí° Conseils pour cr√©er une le√ßon efficace</h3>
            <div class="tips-grid">
                <ul>
                    <li><strong>Objectifs clairs</strong> : Formulez des objectifs mesurables et observables</li>
                    <li><strong>Structure √©quilibr√©e</strong> : Variez les modalit√©s d'apprentissage</li>
                    <li><strong>Progression logique</strong> : Du simple au complexe, du concret √† l'abstrait</li>
                </ul>
                <ul>
                    <li><strong>Engagement actif</strong> : Impliquez les √©l√®ves dans leur apprentissage</li>
                    <li><strong>√âvaluation int√©gr√©e</strong> : Pr√©voyez des moments d'√©valuation formative</li>
                    <li><strong>Diff√©renciation</strong> : Adaptez selon les besoins de vos √©l√®ves</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- JavaScript pour am√©liorer l'exp√©rience utilisateur -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dynamic competences loading based on selected discipline
            const subjectSelect = document.getElementById('subject');
            const competenceSelect = document.getElementById('competence');
            
            subjectSelect.addEventListener('change', async function() {
                const discipline = this.value;
                if (discipline) {
                    try {
                        const response = await fetch(`/api/competences/${discipline}`);
                        const data = await response.json();
                        
                        // Clear existing options except the first one
                        competenceSelect.innerHTML = '<option value="">Choisir la comp√©tence...</option>';
                        
                        // Add new options
                        data.competences.forEach(comp => {
                            const option = document.createElement('option');
                            option.value = comp;
                            option.textContent = comp;
                            competenceSelect.appendChild(option);
                        });
                    } catch (error) {
                        console.error('Erreur lors du chargement des comp√©tences:', error);
                    }
                } else {
                    competenceSelect.innerHTML = '<option value="">Choisir la comp√©tence...</option>';
                }
            });
            
            // Auto-sauvegarde en brouillon (localStorage)
            const form = document.querySelector('form');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            // Charger les donn√©es sauvegard√©es
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(`lesson_draft_${input.name}`);
                if (savedValue && !input.value) {
                    input.value = savedValue;
                }
            });
            
            // Sauvegarder automatiquement les modifications
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    localStorage.setItem(`lesson_draft_${this.name}`, this.value);
                });
            });
            
            // Nettoyer le brouillon lors de la soumission
            form.addEventListener('submit', function() {
                inputs.forEach(input => {
                    localStorage.removeItem(`lesson_draft_${input.name}`);
                });
            });
            
            // Validation avant soumission
            form.addEventListener('submit', function(e) {
                const sessionNumber = document.getElementById('session_number').value;
                const title = document.getElementById('title').value.trim();
                const content = document.getElementById('content').value.trim();
                const objectives = document.getElementById('objectives').value.trim();
                
                if (!sessionNumber || sessionNumber < 1) {
                    alert('‚ö†Ô∏è Le num√©ro de s√©ance doit √™tre sup√©rieur √† 0');
                    e.preventDefault();
                    return;
                }
                
                if (!title) {
                    alert('‚ö†Ô∏è Le titre de la le√ßon est obligatoire');
                    e.preventDefault();
                    return;
                }
                
                if (!objectives) {
                    alert('‚ö†Ô∏è Les objectifs d\'apprentissage sont obligatoires');
                    e.preventDefault();
                    return;
                }
                
                if (!content) {
                    alert('‚ö†Ô∏è Le d√©roulement de la le√ßon est obligatoire');
                    e.preventDefault();
                    return;
                }
            });
            
            // Compteur de caract√®res pour les zones de texte importantes
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                const counter = document.createElement('div');
                counter.className = 'char-counter';
                textarea.parentNode.appendChild(counter);
                
                function updateCounter() {
                    const length = textarea.value.length;
                    counter.textContent = `${length} caract√®res`;
                }
                
                textarea.addEventListener('input', updateCounter);
                updateCounter();
            });
        });
    </script>
</body>
</html>