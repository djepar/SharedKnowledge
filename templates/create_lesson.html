<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er une le√ßon - Fran√ßais Secondaire 2</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dist/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/edit-lesson.css') }}">
</head>
<body>
    <!-- Navigation -->
    {% include 'components/navigation.html' %}

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}" style="max-width: 800px; margin: 0 auto var(--space-lg) auto;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Container principal -->
    <div class="create-lesson-container">
        <!-- Bouton retour -->
        {% if calendar_data %}
            <a href="{{ url_for('calendar') }}" class="back-btn">‚Üê Retour au calendrier</a>
        {% else %}
            <a href="{{ url_for('lessons_list') }}" class="back-btn">‚Üê Retour √† la liste des le√ßons</a>
        {% endif %}
        
        <!-- En-t√™te -->
        <div class="create-lesson-header">
            <h1>üìù Cr√©er une nouvelle le√ßon</h1>
            <p>Concevoir une s√©ance du programme PFEQ fran√ßais secondaire 2</p>
            {% if calendar_data %}
                <div class="calendar-info" style="background: var(--primary-light); color: var(--primary-dark); padding: var(--space-sm); border-radius: var(--radius-sm); margin-top: var(--space-sm);">
                    üìÖ <strong>Le√ßon pr√©-remplie depuis le calendrier</strong><br>
                    Date: {{ calendar_data.date }} | Cours: {{ calendar_data.course }} | P√©riode: {{ calendar_data.period }}
                </div>
            {% endif %}
        </div>
        
        <!-- Formulaire de cr√©ation -->
        <form method="POST" class="lesson-form">
            <!-- Informations g√©n√©rales -->
            <div class="form-section">
                <h2>üìã Informations g√©n√©rales</h2>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="subject">Discipline *</label>
                        <select id="subject" name="subject" required>
                            <option value="">Choisir la discipline...</option>
                            {% for subject in available_subjects %}
                            <option value="{{ subject }}">{{ subject.replace('_', ' ').title() }}</option>
                            {% endfor %}
                        </select>
                        <small>La s√©ance sera automatiquement num√©rot√©e pour cette discipline</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">Titre de la le√ßon *</label>
                        <input type="text" id="title" name="title" required 
                               placeholder="Ex: L'analyse litt√©raire - Les proc√©d√©s stylistiques"
                               value="{{ calendar_data.suggested_title if calendar_data else '' }}">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="lesson_date">Date de la le√ßon *</label>
                        <input type="date" id="lesson_date" name="lesson_date" required 
                               value="{{ calendar_data.date if calendar_data else '' }}">
                        <small>Date exacte de la le√ßon</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="month">Mois (auto-rempli) *</label>
                        <select id="month" name="month" required>
                            <option value="">Choisir le mois...</option>
                            <option value="septembre" {{ 'selected' if calendar_data.month == 'septembre' else '' }}>Septembre</option>
                            <option value="octobre" {{ 'selected' if calendar_data.month == 'octobre' else '' }}>Octobre</option>
                            <option value="novembre" {{ 'selected' if calendar_data.month == 'novembre' else '' }}>Novembre</option>
                            <option value="d√©cembre" {{ 'selected' if calendar_data.month == 'd√©cembre' else '' }}>D√©cembre</option>
                            <option value="janvier" {{ 'selected' if calendar_data.month == 'janvier' else '' }}>Janvier</option>
                            <option value="f√©vrier" {{ 'selected' if calendar_data.month == 'f√©vrier' else '' }}>F√©vrier</option>
                            <option value="mars" {{ 'selected' if calendar_data.month == 'mars' else '' }}>Mars</option>
                            <option value="avril" {{ 'selected' if calendar_data.month == 'avril' else '' }}>Avril</option>
                            <option value="mai" {{ 'selected' if calendar_data.month == 'mai' else '' }}>Mai</option>
                            <option value="juin" {{ 'selected' if calendar_data.month == 'juin' else '' }}>Juin</option>
                        </select>
                        <small>Sera automatiquement mis √† jour selon la date</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="week">Semaine du mois</label>
                        <select id="week" name="week">
                            <option value="">Auto-calcul√©...</option>
                            <option value="1" {{ 'selected' if calendar_data.week_number == 1 else '' }}>Semaine 1</option>
                            <option value="2" {{ 'selected' if calendar_data.week_number == 2 else '' }}>Semaine 2</option>
                            <option value="3" {{ 'selected' if calendar_data.week_number == 3 else '' }}>Semaine 3</option>
                            <option value="4" {{ 'selected' if calendar_data.week_number == 4 else '' }}>Semaine 4</option>
                        </select>
                        <small>Calcul√© automatiquement depuis la date</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="day">Jour de la semaine</label>
                        <select id="day" name="day">
                            <option value="">Auto-calcul√©...</option>
                            <option value="1" {{ 'selected' if calendar_data.day_number == 1 else '' }}>Jour 1</option>
                            <option value="2" {{ 'selected' if calendar_data.day_number == 2 else '' }}>Jour 2</option>
                            <option value="3" {{ 'selected' if calendar_data.day_number == 3 else '' }}>Jour 3</option>
                            <option value="4" {{ 'selected' if calendar_data.day_number == 4 else '' }}>Jour 4</option>
                            <option value="5" {{ 'selected' if calendar_data.day_number == 5 else '' }}>Jour 5</option>
                        </select>
                        <small>Calcul√© automatiquement depuis la date</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="period">P√©riode</label>
                        <select id="period" name="period">
                            <option value="">Choisir la p√©riode...</option>
                            <option value="1" {{ 'selected' if calendar_data.period == '1' else '' }}>P√©riode 1</option>
                            <option value="2" {{ 'selected' if calendar_data.period == '2' else '' }}>P√©riode 2</option>
                            <option value="3" {{ 'selected' if calendar_data.period == '3' else '' }}>P√©riode 3</option>
                            <option value="4" {{ 'selected' if calendar_data.period == '4' else '' }}>P√©riode 4</option>
                            <option value="5" {{ 'selected' if calendar_data.period == '5' else '' }}>P√©riode 5</option>
                        </select>
                        <small>P√©riode de la journ√©e</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="duration">Dur√©e (minutes) *</label>
                        <input type="number" id="duration" name="duration" min="15" max="180" required 
                               placeholder="75" value="75">
                        <small>Dur√©e habituelle : 75 minutes</small>
                    </div>
                    
                </div>
            </div>

            <!-- Contenu p√©dagogique -->
            <div class="form-section">
                <h2>üéØ Contenu p√©dagogique</h2>
                
                <div class="form-group">
                    <label for="objectives">Objectifs d'apprentissage *</label>
                    <textarea id="objectives" name="objectives" required 
                              placeholder="D√©crivez les objectifs sp√©cifiques de cette le√ßon...

Exemples:
‚Ä¢ Identifier les proc√©d√©s stylistiques dans un texte litt√©raire
‚Ä¢ Analyser l'effet des figures de style sur le sens
‚Ä¢ R√©diger une analyse structur√©e de 200 mots"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="content">D√©roulement de la le√ßon *</label>
                    <textarea id="content" name="content" class="content-textarea" required 
                              placeholder="D√©crivez le d√©roulement d√©taill√© de la s√©ance...

Structure sugg√©r√©e:
1. AMORCE (10 min) - Activation des connaissances
2. EXPLORATION (25 min) - D√©couverte du concept
3. PRATIQUE GUID√âE (25 min) - Exercices avec accompagnement
4. PRATIQUE AUTONOME (10 min) - Application individuelle
5. OBJECTIVATION (5 min) - Retour sur les apprentissages

D√©taillez chaque √©tape avec:
‚Ä¢ Les activit√©s propos√©es
‚Ä¢ Le mat√©riel n√©cessaire
‚Ä¢ Les consignes pr√©cises
‚Ä¢ Les crit√®res d'√©valuation"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="materials">Mat√©riel et ressources</label>
                    <textarea id="materials" name="materials" 
                              placeholder="Listez le mat√©riel n√©cessaire pour cette le√ßon...

Exemples:
‚Ä¢ Manuel de fran√ßais (pages XX √† XX)
‚Ä¢ Extraits litt√©raires distribu√©s
‚Ä¢ Grille d'analyse
‚Ä¢ Tableau interactif
‚Ä¢ Vid√©o d'introduction (lien)
‚Ä¢ Cahier d'exercices"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="evaluation">√âvaluation</label>
                        <select id="evaluation" name="evaluation">
                            <option value="">Type d'√©valuation...</option>
                            <option value="formative">√âvaluation formative</option>
                            <option value="sommative">√âvaluation sommative</option>
                            <option value="auto√©valuation">Auto√©valuation</option>
                            <option value="co√©valuation">Co√©valuation</option>
                            <option value="observation">Observation</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="homework">Travaux √† la maison</label>
                        <input type="text" id="homework" name="homework" 
                               placeholder="Ex: Lire le chapitre 3, exercices 1-5">
                    </div>
                </div>
            </div>

            <!-- Diff√©renciation p√©dagogique -->
            <div class="form-section">
                <h2>üîÑ Diff√©renciation p√©dagogique</h2>
                
                <div class="form-group">
                    <label for="adaptations">Adaptations et soutien</label>
                    <textarea id="adaptations" name="adaptations" 
                              placeholder="D√©crivez les adaptations pour diff√©rents profils d'√©l√®ves...

Exemples:
‚Ä¢ Pour les √©l√®ves en difficult√© : support visuel suppl√©mentaire, temps prolong√©
‚Ä¢ Pour les √©l√®ves avanc√©s : exercices d'enrichissement, r√¥le de tuteur
‚Ä¢ Pour les √©l√®ves ayant des besoins particuliers : consignes simplifi√©es
‚Ä¢ Strat√©gies d'enseignement universal (SEU)"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes p√©dagogiques</label>
                    <textarea id="notes" name="notes" 
                              placeholder="Ajoutez vos notes, r√©flexions et am√©liorations √† apporter...

‚Ä¢ Points d'attention particuliers
‚Ä¢ Liens avec les le√ßons pr√©c√©dentes/suivantes
‚Ä¢ Suggestions d'activit√©s alternatives
‚Ä¢ Observations sur l'efficacit√© de la le√ßon
‚Ä¢ Modifications √† pr√©voir pour l'ann√©e suivante"></textarea>
                </div>
            </div>
            
            <!-- Boutons d'action -->
            <div class="form-actions">
                <button type="submit" name="action" value="save" class="btn btn-success btn-lg">
                    üíæ Enregistrer la le√ßon
                </button>
                <button type="submit" name="action" value="save_and_continue" class="btn btn-primary btn-lg">
                    ‚û°Ô∏è Enregistrer et cr√©er la suivante
                </button>
                <a href="{{ url_for('lessons_list') }}" class="btn btn-secondary btn-lg">
                    ‚ùå Annuler
                </a>
            </div>
        </form>
        
        <!-- Conseils p√©dagogiques -->
        <div class="tips-section">
            <h3>üí° Conseils pour cr√©er une le√ßon efficace</h3>
            <div class="tips-grid">
                <ul>
                    <li><strong>Objectifs clairs</strong> : Formulez des objectifs mesurables et observables</li>
                    <li><strong>Structure √©quilibr√©e</strong> : Variez les modalit√©s d'apprentissage</li>
                    <li><strong>Progression logique</strong> : Du simple au complexe, du concret √† l'abstrait</li>
                </ul>
                <ul>
                    <li><strong>Engagement actif</strong> : Impliquez les √©l√®ves dans leur apprentissage</li>
                    <li><strong>√âvaluation int√©gr√©e</strong> : Pr√©voyez des moments d'√©valuation formative</li>
                    <li><strong>Diff√©renciation</strong> : Adaptez selon les besoins de vos √©l√®ves</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- JavaScript pour am√©liorer l'exp√©rience utilisateur -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-populate month/week/day based on lesson date
            const lessonDateInput = document.getElementById('lesson_date');
            const monthSelect = document.getElementById('month');
            const weekSelect = document.getElementById('week');
            const daySelect = document.getElementById('day');
            
            const monthNames = {
                0: 'janvier', 1: 'f√©vrier', 2: 'mars', 3: 'avril', 4: 'mai', 5: 'juin',
                6: 'juillet', 7: 'ao√ªt', 8: 'septembre', 9: 'octobre', 10: 'novembre', 11: 'd√©cembre'
            };
            
            lessonDateInput.addEventListener('change', function() {
                if (this.value) {
                    const date = new Date(this.value);
                    const month = monthNames[date.getMonth()];
                    const weekNumber = Math.ceil(date.getDate() / 7);
                    const dayNumber = date.getDay(); // 0=Sunday, 1=Monday, etc.
                    
                    // Set month
                    monthSelect.value = month;
                    
                    // Set week (1-4)
                    weekSelect.value = weekNumber.toString();
                    
                    // Set day (convert Sunday=0 to a better mapping for school days)
                    const schoolDay = dayNumber === 0 ? 5 : dayNumber; // Sunday becomes 5, Monday=1, etc.
                    daySelect.value = schoolDay.toString();
                }
            });
            
            
            // Auto-sauvegarde en brouillon (localStorage)
            const form = document.querySelector('form');
            const inputs = form.querySelectorAll('input, select, textarea');
            
            // Charger les donn√©es sauvegard√©es
            inputs.forEach(input => {
                const savedValue = localStorage.getItem(`lesson_draft_${input.name}`);
                if (savedValue && !input.value) {
                    input.value = savedValue;
                }
            });
            
            // Sauvegarder automatiquement les modifications
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    localStorage.setItem(`lesson_draft_${this.name}`, this.value);
                });
            });
            
            // Nettoyer le brouillon lors de la soumission
            form.addEventListener('submit', function() {
                inputs.forEach(input => {
                    localStorage.removeItem(`lesson_draft_${input.name}`);
                });
            });
            
            // Validation avant soumission
            form.addEventListener('submit', function(e) {
                const title = document.getElementById('title').value.trim();
                const content = document.getElementById('content').value.trim();
                const objectives = document.getElementById('objectives').value.trim();
                
                if (!title) {
                    alert('‚ö†Ô∏è Le titre de la le√ßon est obligatoire');
                    e.preventDefault();
                    return;
                }
                
                if (!objectives) {
                    alert('‚ö†Ô∏è Les objectifs d\'apprentissage sont obligatoires');
                    e.preventDefault();
                    return;
                }
                
                if (!content) {
                    alert('‚ö†Ô∏è Le d√©roulement de la le√ßon est obligatoire');
                    e.preventDefault();
                    return;
                }
            });
            
            // Compteur de caract√®res pour les zones de texte importantes
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                const counter = document.createElement('div');
                counter.className = 'char-counter';
                textarea.parentNode.appendChild(counter);
                
                function updateCounter() {
                    const length = textarea.value.length;
                    counter.textContent = `${length} caract√®res`;
                }
                
                textarea.addEventListener('input', updateCounter);
                updateCounter();
            });
        });
    </script>
</body>
</html>